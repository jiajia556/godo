# GoDo - Go Development Accelerator Tool

GoDo (Go Development Accelerator Tool) is a CLI scaffolding and code generation tool for Go web projects. It helps you bootstrap a runnable API project structure quickly by generating controllers, routes, models, middleware, and by providing a cross-platform build workflow.

It’s especially handy if you’re used to building APIs with **Gin + GORM** and the typical layering (controller/service/model/router). GoDo takes care of repetitive project structure, boilerplate code, and router maintenance.

- Repo: <https://github.com/jiajia556/godo>
- License: MIT

---

## Features

- `init`: initialize a project structure and generate `godoconfig.json`
- `gen cmd`: generate a new cmd module (an independent runnable service entry)
- `gen ctrl`: generate a controller (optionally with actions)
- `gen act`: append actions to an existing controller
- `gen rt`: generate/update routes based on controller comments (AST-based)
- `gen model`: generate database models from a SQL file or a config file
- `gen mdw`: generate Gin middleware files
- `build`: cross-platform build and output to `bin/` (routes are regenerated before building)

---

## Install

### Option 1: build from source

```bash
git clone https://github.com/jiajia556/godo.git
cd godo
go mod download
go build -o godo ./cmd/godo
```

On Windows, you’ll get `godo.exe`. Put it somewhere in your PATH.

### Option 2: go install

```bash
go install github.com/jiajia556/godo/cmd/godo@latest
```

Verify:

```bash
godo --version
godo --help
```

---

## Quick Start (recommended)

> This example uses the default API project.

### 1) Initialize a project

```bash
godo init myproject
cd myproject
```

### 2) Project structure after `init`

> `init` generates a runnable default API skeleton (the default cmd is usually `default-api`). The template may slightly vary by version, but the structure is typically like this:

```text
myproject/
├── bin/                          # build output
├── cmd/
│   └── default-api/
│       └── main.go               # default API entry
├── internal/
│   ├── common/                   # shared code (config/db/base types, etc.)
│   └── default-api/
│       ├── config/               # module config
│       ├── service/              # service layer
│       └── transport/http/
│           ├── api/controller/   # controllers (generated by `godo gen ctrl`)
│           └── router/           # routes (generated/updated by `godo gen rt`)
├── godoconfig.json               # GoDo config
├── go.mod
└── go.sum
```

### 3) Generate a controller (optionally with actions)

```bash
# generate controller skeleton only
godo gen ctrl user

# generate controller + actions (ActionName:HTTPMethod, HTTPMethod can be omitted)
godo gen ctrl user GetList:POST GetDetail:GET Create:POST Update:POST Delete:GET
```

### 4) Generate routes (AST-based)

```bash
godo gen rt
```

### 5) Build and run

```bash
# build a cmd module, output to bin/
godo build default-api

# run (on Windows it will be default-api.exe)
./bin/default-api
```

---

## Usage (more details)

### 1) `init`: initialize a project

```bash
godo init <project-name>
```

Notes:
- `<project-name>` can be a simple folder name (e.g. `myapp`) or a module-like path (e.g. `example.com/myapp`).
- `godoconfig.json` will be generated, and subsequent commands will prefer it.

### 2) `gen cmd`: generate a new cmd module

To generate a new runnable module (for example, `admin-api`):

```bash
godo gen cmd admin-api
```

Typically it adds:
- `cmd/admin-api/main.go`
- `internal/admin-api/...` (controller/router/service directories for that module)

### 3) `gen ctrl`: generate a controller

```bash
godo gen ctrl <controller-route> [actions...]

# optionally specify the target cmd module
godo gen ctrl <controller-route> [actions...] --cmd <cmd-name>
```

Arguments:
- `controller-route`: controller route name, supports nesting (e.g. `user/profile`).
- `actions` (optional): recommended format is `ActionName:HTTPMethod` (e.g. `GetDetail:GET`). HTTPMethod can be omitted (defaults to POST).

Examples:

```bash
# generate user controller in the default cmd module
godo gen ctrl user

# generate into the admin-api module
godo gen ctrl user GetDetail:GET --cmd admin-api
```

### 4) `gen act`: append actions to an existing controller

```bash
godo gen act [actions...] --ctrl <controller-route>

# optionally specify the target cmd module
godo gen act [actions...] --ctrl <controller-route> --cmd <cmd-name>
```

Notes:
- `--ctrl` (or `-c`) is required.
- You can specify multiple actions separated by spaces.

Example:

```bash
godo gen act Export:POST Import:POST -c user
```

### 5) `gen rt`: generate/update routes

```bash
godo gen rt

# optionally specify the target cmd module
godo gen rt --cmd <cmd-name>
```

It scans your controller directory and generates/updates the router file based on comments.

### 6) `gen mdw`: generate middleware

```bash
godo gen mdw <middleware-name> [middleware-name...]
```

Example:

```bash
godo gen mdw auth logging
```

### 7) `gen model`: generate database models

```bash
godo gen model <config.json|schema.sql>
```

Notes:
- This command takes exactly one argument: a file path.
- You can pass either:
  - `schema.sql`: a SQL file containing `CREATE TABLE ...` statements, or
  - `config.json`: a database connection / generation config file (exact fields depend on the template/implementation).

Example:

```bash
godo gen model schema.sql
```

### 8) `build`: build

```bash
godo build <app-name> [--version <ver>] [--goos <os>] [--goarch <arch>]
```

Notes:
- `<app-name>` is the module name under `cmd/` (e.g. `default-api`, `admin-api`).
- Before building, it regenerates routes once to keep them up-to-date.

Examples:

```bash
# normal build
godo build default-api

# with version
godo build default-api --version v1.2.0

# cross compile (example: Linux amd64)
godo build default-api --goos linux --goarch amd64
```

---

## Command Cheatsheet

> Based on the current implementation (Cobra CLI). 

```text
godo
├── init  [project-name]
├── gen
│   ├── cmd   [cmd-name]
│   ├── ctrl  [controller-route] [actions...]
│   │        --cmd <name>
│   ├── act   [actions...]
│   │        --cmd <name>
│   │        --ctrl, -c <controller-route>
│   ├── rt
│   │        --cmd <name>
│   ├── model <config.json|schema.sql>
│   └── mdw   [middleware-name...]
└── build [cmd-name]
         --version, -v <ver>
         --goos <os>
         --goarch <arch>
```

---

## Route Annotations (read by `gen rt`)

Use annotations in controller method comments:

- `@http_method GET|POST`
- `@middleware <name...>` (space-separated)

Example (annotation format only):

```text
// @http_method GET
// @middleware auth logging
// func (ctrl *UserController) GetDetail(c *gin.Context) {
//     // TODO
// }
```

---

## Config: `godoconfig.json`

After initialization, `godoconfig.json` will be created. At runtime, GoDo will look for it by walking up from the current directory. If it can’t find one, it will try to infer project root information from `go.mod`.

A minimal example:

```json
{
  "project_name": "myproject",
  "default_cmd": "default-api",
  "default_goos": "linux",
  "default_goarch": "amd64"
}
```

Fields:
- `project_name`: project/module name
- `default_cmd`: default cmd module name (e.g. `default-api`)
- `default_goos`: default target OS (can be overridden by `build --goos`)
- `default_goarch`: default target arch (can be overridden by `build --goarch`)

---

## FAQ

### 1) `godo` not found

- Windows: make sure it’s in PATH, then try `where godo`
- Linux/macOS: try `which godo`

### 2) `gen rt` didn’t generate the expected routes

- Make sure controllers are under the correct module controller directory
- Ensure annotations match the expected format (`@http_method` / `@middleware`)

### 3) Where is the build output?

- `godo build <app-name>` outputs to `bin/` (Windows binaries use `.exe` suffix)

---

## Optional dependency

Some workflows may rely on extra tooling:

```bash
# format and organize imports
go install golang.org/x/tools/cmd/goimports@latest
```

